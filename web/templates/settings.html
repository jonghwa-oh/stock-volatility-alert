{% extends "base.html" %}

{% block title %}์ค์ - ์ฃผ์ ์๋ฆผ{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-6">
    <h1 class="text-2xl font-bold">โ๏ธ ์ค์</h1>
    
    <!-- ํ๋กํ -->
    <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700">
        <h2 class="text-lg font-bold mb-4">๐ค ํ๋กํ</h2>
        
        <div class="space-y-4">
            <div class="flex items-center justify-between">
                <span class="text-slate-400">์ฌ์ฉ์ ์ด๋ฆ</span>
                <span class="font-medium">{{ user.name }}</span>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-slate-400">ํฌ์ ๊ธ์ก</span>
                <span class="font-medium">{{ "{:,.0f}".format(user.investment_amount) }}์</span>
            </div>
        </div>
    </div>
    
    <!-- ์๋ฆผ ์ค์ (ntfy) -->
    <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700" 
         x-data="{ 
             enabled: {{ 'true' if user.notification_enabled else 'false' }},
             ntfyTopic: '{{ ntfy_topic or '' }}',
             saving: false,
             testSending: false,
             message: ''
         }">
        <h2 class="text-lg font-bold mb-4">๐ ์๋ฆผ ์ค์ (ntfy)</h2>
        
        <div class="space-y-6">
            <!-- ์๋ฆผ ํ์ฑํ -->
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-medium">์ค์๊ฐ ์๋ฆผ</p>
                    <p class="text-sm text-slate-400">๋งค์ ํ์ด๋ฐ ๋๋ฌ ์ ์๋ฆผ ์์</p>
                </div>
                
                <button @click="
                    enabled = !enabled;
                    fetch('/api/user/notification', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({enabled: enabled})
                    })
                " class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"
                   :class="enabled ? 'bg-blue-600' : 'bg-slate-600'">
                    <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"
                          :class="enabled ? 'translate-x-6' : 'translate-x-1'"></span>
                </button>
            </div>
            
            <!-- ntfy ํํฝ ์ค์ -->
            <div class="border-t border-slate-700 pt-4 space-y-4">
                <div>
                    <label class="block text-sm text-slate-400 mb-2">ntfy ํํฝ</label>
                    <input type="text" x-model="ntfyTopic" 
                           placeholder="์: stock-alert-myname"
                           class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl focus:outline-none focus:border-blue-500">
                    <p class="text-xs text-slate-500 mt-1">ntfy ์ฑ์์ ๊ตฌ๋ํ ํํฝ ์ด๋ฆ์ ์๋ฅํ์ธ์</p>
                </div>
                
                <div class="flex gap-2">
                    <button @click="
                        saving = true;
                        fetch('/api/settings/ntfy', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({topic: ntfyTopic})
                        }).then(r => r.json()).then(d => {
                            message = d.success ? 'โ ์์ฅ๋์์ต๋๋ค' : 'โ ์์ฅ ์คํจ';
                            saving = false;
                            setTimeout(() => message = '', 3000);
                        })
                    " :disabled="saving || !ntfyTopic"
                       class="flex-1 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 rounded-xl transition-colors">
                        <span x-text="saving ? '์์ฅ ์ค...' : '๐พ ์์ฅ'"></span>
                    </button>
                    
                    <button @click="
                        testSending = true;
                        fetch('/api/settings/ntfy/test', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({topic: ntfyTopic})
                        }).then(r => r.json()).then(d => {
                            message = d.success ? 'โ ํ์คํธ ์๋ฆผ ์์ก!' : 'โ ์์ก ์คํจ: ' + (d.error || '์ ์ ์๋ ์ค๋ฅ');
                            testSending = false;
                            setTimeout(() => message = '', 5000);
                        })
                    " :disabled="testSending || !ntfyTopic"
                       class="px-6 py-3 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 rounded-xl transition-colors">
                        <span x-text="testSending ? '์์ก ์ค...' : '๐ ํ์คํธ'"></span>
                    </button>
                </div>
                
                <p x-show="message" x-text="message" class="text-center py-2"></p>
                
                <!-- ntfy ์ค์น ์๋ด -->
                <div class="mt-4 p-4 bg-slate-700/50 rounded-xl text-sm">
                    <p class="font-medium mb-2">๐ฑ ntfy ์ฑ ์ค์น</p>
                    <ul class="text-slate-400 space-y-1">
                        <li>โข iOS: App Store์์ "ntfy" ๊ฒ์</li>
                        <li>โข Android: Play Store์์ "ntfy" ๊ฒ์</li>
                        <li>โข ์ฑ์์ ์์ ๋์ผํ ํํฝ์ ๊ตฌ๋ํ์ธ์</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ๋ณด์ -->
    <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700">
        <h2 class="text-lg font-bold mb-4">๐ ๋ณด์</h2>
        
        <a href="{{ url_for('auth.change_password') }}"
           class="flex items-center justify-between p-4 bg-slate-700/50 rounded-xl hover:bg-slate-700 transition-colors">
            <div>
                <p class="font-medium">๋น๋ฐ๋ฒํธ ๋ณ๊ฒฝ</p>
                <p class="text-sm text-slate-400">์น ๋ก๊ทธ์ธ ๋น๋ฐ๋ฒํธ๋ฅผ ๋ณ๊ฒฝํฉ๋๋ค</p>
            </div>
            <span class="text-slate-400">โ</span>
        </a>
    </div>
    
    <!-- ๋ก๊ทธ์์ -->
    <a href="{{ url_for('auth.logout') }}"
       class="block w-full py-4 text-center bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-2xl transition-colors border border-red-500/30">
        ๐ช ๋ก๊ทธ์์
    </a>
</div>
{% endblock %}





